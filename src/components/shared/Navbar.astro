---
import { Image } from 'astro:assets'
import logo from '@images/bageledu-logo-transparent.png'
import Button from './Button.astro'
import { Icon } from 'astro-icon/components'
import { getCollection } from 'astro:content'
import type { Program } from '@types'

const navigation = [
  { label: 'Home', href: '/' },
  { label: 'About', href: '/about' },
  { label: 'Our Services', href: '/programs' },
  { label: 'Admission Guide', href: '/admission-guide' },
  // { label: 'Resources' },
  { label: 'Blog & News', href: '/blog' },
  // { label: 'Parents', href: '/parents' },
  // { label: 'Contact', href: '/contact' },
]

const pathname = Astro.url.pathname.replace(/(?<=.)\/$/, '')
const programs: Program[] = await getCollection('programs')
const admissionGuide = await getCollection('admissionGuide')
const resources = await getCollection('resources')
---

<header class="flex flex-wrap lg:justify-start lg:flex-nowrap z-50 w-full py-7">
  <nav class="relative max-w-7xl w-full flex flex-wrap lg:grid lg:grid-cols-12 basis-full items-center px-4 md:px-6 lg:px-8 mx-auto">
    {/* Logo Section */}
    <div class="lg:col-span-3 flex items-center">
      <a href="/" class="flex-none">
        <Image src={logo} alt="Bright" class="w-28 h-auto" />
      </a>
    </div>

    {/* Navigation Links - Center */}
    <div id="navbar-collapse" class="hs-collapse hidden overflow-hidden transition-all duration-300 basis-full grow lg:block lg:w-auto lg:basis-auto lg:order-2 lg:col-span-6">
      <div class="flex flex-col gap-y-4 gap-x-0 mt-5 lg:flex-row lg:justify-center lg:items-center lg:gap-y-0 lg:gap-x-7 lg:mt-0">
        {navigation.map((link) => (
          <div>
            {link.label === 'Our Services' || link.label === 'Admission Guide' || link.label === 'Resources' ? (
              // Dropdown menus
              <div class="hs-dropdown relative inline-flex [--auto-close:inside]">
                <button type="button" 
                  class="inline-flex items-center text-black hover:text-gray-600 focus:outline-none"
                >
                  {link.label}
                  <Icon name="chevron-down" class="w-4 h-4 ml-1" />
                </button>

                <div class="hs-dropdown-menu transition-[opacity,margin] duration-[0.1ms] md:duration-[150ms] hs-dropdown-open:opacity-100 opacity-0 hidden z-10 top-full bg-white md:shadow-md rounded-lg p-2 md:p-4 dark:bg-gray-800 dark:border dark:border-gray-700 dark:divide-gray-700 before:absolute before:-top-5 before:start-0 before:w-full before:h-5">
                  {(link.label === 'Our Services' ? programs : link.label === 'Admission Guide' ? admissionGuide : resources).map((item) => (
                    <a href={`/${link.label === 'Our Services' ? 'programs' : link.label === 'Admission Guide' ? 'admission-guide' : 'resources'}/${item.slug}`}
                      class="flex items-center gap-x-3.5 py-2 px-3 rounded-lg text-sm text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300 dark:focus:bg-gray-700"
                    >
                      {item.data.name}
                    </a>
                  ))}
                </div>
              </div>
            ) : (
              // Regular links
              <a href={link.href} 
                class:list={[
                  'inline-block text-black hover:text-gray-600 focus:outline-none',
                  pathname === link.href && 'relative before:absolute before:bottom-0.5 before:start-0 before:-z-[1] before:w-full before:h-1 before:bg-lime-400'
                ]}
              >
                {link.label}
              </a>
            )}
          </div>
        ))}
      </div>
    </div>

    {/* Right Buttons */}
    <div class="flex items-center gap-x-1 lg:gap-x-2 ms-auto py-1 lg:ps-6 lg:order-3 lg:col-span-3">
      <Button href="/contact" variant="primary">Free Consultation</Button>

      {/* Mobile Menu Button */}
      <div class="lg:hidden">
        <button type="button" 
          class="hs-collapse-toggle size-[38px] flex justify-center items-center text-sm font-semibold rounded-xl border border-gray-200 text-black hover:bg-gray-100"
          data-hs-collapse="#navbar-collapse"
        >
          <Icon name="menu" class="w-5 h-5 hs-collapse-open:hidden" />
          <Icon name="x" class="w-5 h-5 hidden hs-collapse-open:block" />
        </button>
      </div>
    </div>
  </nav>
</header>
